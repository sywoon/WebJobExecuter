!function(){"use strict";class t{static create(e,s,i,r=null){let l;return t._pool=t._pool||{},t._pool.length>0?(l=t._pool.pop()).inpool=!1:l=new t,l.setTo(e,s,i,r),l}constructor(t,e,s,i=null){this.setTo(t,e,s,i)}setTo(t,e,s,i=null){this.caller=t,this.method=e,this.args=i,this.once=s}equalTo(t,e){return this.caller===t&&this.method===e}recycle(){this.inpool||(this.setTo(null,null,!1),this.inpool=!0,t._pool.push(this))}run(){if(null==this.method)return void(this.once&&this.recycle());let t=this.method.apply(this.caller,this.args);return this.once&&this.recycle(),t}runWith(...t){if(null==this.method)return void(this.once&&this.recycle());if(0===t.length)return this.run();let e=this.args||[];e=e.concat(t);let s=this.method.apply(this.caller,e);return this.once&&this.recycle(),s}}class e{static create(){return e._pool=e._pool||{},e._pool.length>0?e._pool.pop():new e}constructor(){this.clear()}clear(){this.handler&&this.handler.recycle(),this.handler=null,this.delay=0,this.timeStart=0}recycle(){this.clear(),e._pool.push(this)}}class s{get speed(){return this._speed}set speed(t){this._speed=t}constructor(){this._timerVos=[],this._curTime=Date.now(),this._speedLast=1,this._speed=1}pause(){0!==this._speed&&(this._speedLast=this._speed,this._speed=0)}resume(){0===this._speed&&(this._speed=this._speedLast)}once(t,e,s,i,r=null){this._addCall(!0,1,t,e,s,i,r)}loop(t,e,s,i=0,r,l=null){this._addCall(!1,i,t,e,s,r,l)}clear(t,e=null){for(let s of this._timerVos)s.handler&&(null==e&&s.handler.caller===t||s.handler.equalTo(t,e))&&s.clear()}_addCall(s,i=0,r,l,a,o,n){let h=null;o&&(h=this._getVo(l,a))&&(h.handler.args=n),h||((h=e.create()).handler=t.create(l,a,s,n),this._timerVos.push(h)),h.repeatTimes=i,h.delay=r,h.timeStart=this._curTime}_getVo(t,e){for(let s of this._timerVos)if(s.handler&&s.handler.equalTo(t,e))return s;return null}update(){this._speed<=0||(this._curFrames++,this._curTime=Date.now(),this._updateTimes(),this._curFrames%200==0&&this._clearTimerVo())}_updateTimes(){for(let t of this._timerVos){if(!t.handler)continue;Math.floor((this._curTime-t.timeStart)*this._speed)<t.delay||(t.handler.run(),t.timeStart=this._curTime,t.repeatTimes>0&&(t.repeatTimes--,t.repeatTimes<=0&&t.clear()))}}_clearTimerVo(){let t=[];for(let e of this._timerVos)e.handler?t.push(e):e.recycle();this._timerVos=t}}class i{constructor(t,...e){this.records={},this.allCbk=t,this.params=e}addCheck(t){this.records[t]=!1}cbkListener(t){this.records[t]=!0,this._checkAll()}_checkAll(){for(let t in this.records)if(!this.records[t])return;this.allCbk&&this.allCbk.apply(null,this.params||[])}}class r{static getBaseUrl(){return window.location.origin}}class l{constructor(){this.http=new XMLHttpRequest,this.http.timeout=0,this.responseType="text"}setTimeout(t){this.http&&(this.http.timeout=t)}setCallback(t){this.cbk=t}send(t,e,s,i,r){var l=this.http;l.open(s,t,!0);var a=!1;if(r)for(var o=0;o<r.length;o++)l.setRequestHeader(r[o++],r[o]);else e&&"string"!=typeof e?(l.setRequestHeader("Content-Type","application/json"),a=!0):l.setRequestHeader("Content-Type","application/x-www-form-urlencoded");this.responseType=i;let n="arraybuffer"!==i?"text":"arraybuffer";l.responseType=n;var h=this;l.onerror=function(t){h._onError(t)},l.onabort=function(t){h._onAbort(t)},l.onprogress=function(t){h._onProgress(t)},l.onload=function(t){h._onLoad(t)},l.send(a?JSON.stringify(e):e)}_onProgress(t){this.cbk&&this.cbk("onprogress",t.loaded,t.total)}_onAbort(t){this.cbk&&this.cbk("onabort")}_onError(t){console.error("Request failed Status:"+this.http.status+" text:"+this.http.statusText),this.cbk&&this.cbk("onerror")}_onLoad(){var t=this.http,e=void 0!==t.status?t.status:200;200===e||204===e||0===e?this.complete():console.error("["+t.status+"]"+t.statusText+":"+t.responseURL)}complete(){var t;t="json"===this.responseType?JSON.parse(this.http.responseText):this.http.response||this.http.responseText,this.cbk&&this.cbk("complete",t)}}let a={MAX_QUEUE_LEN:3,TOOL_FOLDER_NAME:"WebJobExecuter",PROJ_STATUS_UPDATE_INTERVEL:6e3,VO:{DATA_PROJ_STATUS:"DATA_PROJ_STATUS"}},o={FILE:"FILE",CMD:"CMD",STATUS:"STATUS"},n={UPDATE_CLIENT:1,SYNC_ART_RES:2},h={CMD_UPDATE_CLIENT:1,CMD_SYNC_ART_RES:2,STATUS_PROJECT:101,STATUS_RESET_STATUS:102,FILE_READ_CONFIG:201},u={[h.CMD_UPDATE_CLIENT]:!0,[h.CMD_SYNC_ART_RES]:!0},c={COMMON:-1,BUSY:-2,CMD_LOST:-3,UNKNOW:-100},d={DATA_QUEUE_CHG:"DATA_QUEUE_CHG",SERVER_BUSY:"SERVER_BUSY"},_={PROJ_STATUS_UPDATE:"PROJ_STATUS_UPDATE"},m={NONE:0,PREPARE:1,EXPORT_EXCEL:2,EXPORT_PROTOL:3,EXPORT_UI:4,COMPILE_CLIENT:5,COMPRESS_IMAGE:6,SYNC_ART_RES:20,COMPRESS_SPINE:21,ERROR:100};class p{constructor(t){this.baseUrl=r.getBaseUrl(),this.xhr=new l,this.xhr.setCallback(this._onHttpResponse.bind(this)),this._loadConfig(),this._initCbk=t}_loadConfig(){let t=`${this.baseUrl}/${a.TOOL_FOLDER_NAME}/config/tools_config.json`;this.xhr.send(t,"","get","json")}_onHttpResponse(t,e){"onerror"==t?console.error("load config failed tools_config.json"):"complete"==t&&(this.toolsCfg=e,this._initCbk&&this._initCbk())}getConfig(t){return this.toolsCfg[t]}}class S{constructor(t,e){this.type=t,this.mgr=e,this.jobSender={}}registerJobSender(t,e){this.jobSender[t]=e}sendServerCmd(t,e){this.mgr.sendServerCmd({plugin_type:this.type,cmd:t,data:e})}dealData(t){let e=this.jobSender[t.cmd];e?e.dealData(t):console.error("sender not found",t)}}let T={[o.FILE]:class extends S{dealData(t){super.dealData(t)}},[o.CMD]:class extends S{dealData(t){super.dealData(t)}},[o.STATUS]:class extends S{dealData(t){super.dealData(t)}}};class g{constructor(){this.plugins=[],this.serverSendCall=null}registerPlugins(){console.assert(0==this.plugins.length);for(let t in T){let e=new T[t](t,this);this.plugins[t]=e}}registerJobSender(t,e,s){this.plugins[t].registerJobSender(e,s)}getPlugin(t){return this.plugins[t]}setServerSendCall(t){this.serverSendCall=t}sendServerCmd(t){this.serverSendCall&&this.serverSendCall(t)}setServerBusyCall(t){this.serverBusyCall=t}dealResponseData(t){if(!t||!t.plugin_type)return void console.error("data is null");if(t.code==c.COMMON)return void console.error(t.msg);if(t.code==c.BUSY){if(this.serverBusyCall){let e={plugin_type:t.plugin_type,cmd:t.cmd,data:t.data};this.serverBusyCall(e)}return}let e=this.plugins[t.plugin_type];e?e.dealData(t):console.error("plugin not found:"+t.plugin_type)}}class C{initAll(t){let e=new s;this.timer=e;let r=new i(t);r.addCheck("toolsCfg"),this.toolsCfg=new p(r.cbkListener.bind(r,"toolsCfg"));let l=new g;l.registerPlugins(),this.plugin=l,this.urlParams=this._parseUrlParams(),setInterval(()=>{this.timer.update()},1e3/30)}isAdmin(){return"1"==this.urlParams.admin}_parseUrlParams(){let t=window.location.search.replace("?","").split("&"),e={};for(let s of t){if(!s)continue;let t=s.split("=");2==t.length&&(e[t[0]]=t[1])}return e}}class E{constructor(){this._events={}}on(t,e,s,i=!0,r=null){return this._createListener(t,e,s,!1,i,r)}once(t,e,s,i=!0,r=null){return this._createListener(t,e,s,!0,i,r)}_createListener(e,s,i,r,l,a){l&&this.off(e,s,i);let o=t.create(s,i,r,a);return this._events[e]||(this._events[e]=[]),this._events[e].push(o),this}off(t,e,s){if(!this._events[t])return;let i=this._events[t];for(let t=i.length-1;t>=0;t--){let r=i[t];r&&r.equalTo(e,s)&&(r.recycle(),i.splice(t,1))}}offAllCaller(t,e=null){if(!e||this._events[e])if(e&&t){let s=this._events[e];for(let e=s.length-1;e>=0;e--){let i=s[e];i&&i.caller===t&&(i.recycle(),s.splice(e,1))}}else if(!t||e);else for(let e in this._events){let s=this._events[e];for(let e=s.length-1;e>=0;e--){let i=s[e];i&&i.caller===t&&(i.recycle(),s.splice(e,1))}}}offAll(t){if(!this._events[t])return;let e=this._events[t];for(let t of e)t&&t.recycle();delete this._events[t]}fire(t,...e){if(!this._events[t])return;let s=this._events[t],i=0;for(let t=0;t<s.length;t++){let r=s[t];null==r?i++:(r.once&&(s[t]=null,i++),r.runWith(...e))}i===s.length&&delete this._events[t]}}class A{constructor(t,e,s){this.cmd=t,this.pluginType=e,this.logic=s,this.mgr=s.mgr}setMonitor(t){this.monitor=t}getMonitor(){return this.monitor}getPlugin(){return this.mgr.plugin.getPlugin(this.pluginType)}sendServerCmd(t){this.getPlugin().sendServerCmd(this.cmd,t),this.monitor&&this.monitor.onSendServerCmd(this.cmd,t)}dealData(t){this.monitor&&this.monitor.onDealResponseData(t)}}class f extends A{dealData(t){super.dealData(t),this.logic.onJobCmdBack(t.cmd,t.data)}}class D{constructor(t){this.owner=t,this.logic=t.logic,this.mgr=t.logic.mgr,this.cmd=t.cmd}onSendServerCmd(t,e){}onDealResponseData(t){}}class R extends D{onSendServerCmd(t,e){super.onSendServerCmd(t,e)}onDealResponseData(t){super.onDealResponseData(t),this._updateVoData(t)}_updateVoData(t){let e=a.VO.DATA_PROJ_STATUS,s=this.logic.getData(e);s.updateData();let i=t.data.projName,r=()=>{s.isStatusDone(i)&&(this.mgr.client.onCmdEnd(this.cmd),t.cmd==h.CMD_UPDATE_CLIENT?console.log("项目更新结束:"+i):t.cmd==h.CMD_SYNC_ART_RES&&console.log("资源同步结束:"+i),this.logic.off(_.PROJ_STATUS_UPDATE,this,r))};this.logic.on(_.PROJ_STATUS_UPDATE,this,r)}}class P extends D{onDealResponseData(t){super.onDealResponseData(t),this.mgr.client.onCmdEnd(t.cmd)}}class b{constructor(t){this.logic=t,this.mgr=t.mgr,this.projStatusAll={}}isStatusDone(t){let e=this.projStatusAll[t];return!e||(e.status==m.NONE||e.status==m.ERROR)}setStatus(t,e){let s=this.projStatusAll[t];s?s.status=e:this.projStatusAll[t]={status:e}}isAllDone(){let t=!0;for(let e in this.projStatusAll){let s=this.projStatusAll[e];if(s.status!=m.NONE&&s.status!=m.ERROR){t=!1;break}}return t}updateData(){this.logic.sendJobCmd(h.STATUS_PROJECT,{},this._onProjStatusBack,this)}_onProjStatusBack(t){t.projName?this.setProjStatus(t.projName,t.data):this.setProjStatusAll(t.data),this.isAllDone()||this.mgr.timer.once(a.PROJ_STATUS_UPDATE_INTERVEL,this,this.updateData)}getProjStatus(t){return this.projStatusAll[t]||{}}getProjStatusAll(){return this.projStatusAll}setProjStatus(t,e){this.projStatusAll[t]=e,this.logic.fire(_.PROJ_STATUS_UPDATE,this)}setProjStatusAll(t){this.projStatusAll=t,this.logic.fire(_.PROJ_STATUS_UPDATE,this)}}let U={[h.CMD_UPDATE_CLIENT]:[class extends A{dealData(t){super.dealData(t),this.logic.onJobCmdBack(t.cmd,t.data)}},R],[h.CMD_SYNC_ART_RES]:[class extends A{dealData(t){super.dealData(t),this.logic.onJobCmdBack(t.cmd,t.data)}},R]},N={[h.STATUS_PROJECT]:[f,P],[h.STATUS_RESET_STATUS]:[f,P]},y={[h.FILE_READ_CONFIG]:[class extends A{dealData(t){super.dealData(t),this.logic.onJobCmdBack(t.cmd,t.data)}},P]};class O extends E{constructor(t){super(),this.mgr=t,this.datas={},this.jobs={},this._initVo()}_initVo(){let t=a.VO.DATA_PROJ_STATUS,e=new b(this);this.saveData(t,e)}updateVoData(){this.updateVoProjStatus()}updateVoProjStatus(){let t=a.VO.DATA_PROJ_STATUS;this.getData(t).updateData()}getJobSender(t){return this.jobs[t]}makeUniqueKey(t,e){let s;switch(t){case h.CMD_UPDATE_CLIENT:case h.CMD_SYNC_ART_RES:s=`${t}_${e.projName}`;case h.STATUS_PROJECT:s=e.projName?`${t}_${e.projName}`:`${t}`;break;case h.STATUS_RESET_STATUS:s=`${t}_${e.projName}`;break;case h.FILE_READ_CONFIG:s=`${t}_${e.filename}`;break;default:s=`${t}`}return s}sendJobCmd(t,e,s,i){let r=this.getJobSender(t);e.__key=this.makeUniqueKey(t,e),r.sendServerCmd(e),s&&this.once(e.__key,i,s)}onJobCmdBack(t,e){let s=this.makeUniqueKey(t,e);this.fire(s,e)}saveData(t,e){this.datas[t]=e}getData(t){return this.datas[t]}registerAll(){this._registerTypeJobs(o.CMD,U),this._registerTypeJobs(o.STATUS,N),this._registerTypeJobs(o.FILE,y)}_registerTypeJobs(t,e){let s=this.mgr.plugin;for(let i in e){let r=Number(i),l=e[i],a=new l[0](r,t,this);l[1]&&a.setMonitor(new l[1](a)),s.registerJobSender(t,i,a),this.jobs[i]=a}}}class j extends E{constructor(t){super(),this.mgr=t;let e=t.toolsCfg.getConfig("node_server");this.urlServer=`http://${e.ip}:${e.port}`,this.urlWeb=r.getBaseUrl(),this.cmdQueue=[],this.cmdQueueASync=[],this.lastSendSync=!0,this.dealDataCall=null,this.inRequest=!1,this.xhr=new l,this.xhr.setCallback(this._onHttpResponse.bind(this))}_log(...t){this.mgr.isAdmin()&&console.log(...t)}setDealDataCall(t){this.dealDataCall=t}onServerBusy(t){this.fire(d.SERVER_BUSY,t)}send(t){this.pushToQueue(t),this._sendNext(!0)}onCmdEnd(t){this._sendNext(u[t])}_filterSameCmd(t){if(0==t.length)return;let e=t[t.length-1].__key;if(e)for(let s=t.length-2;s>=0;s--)t[s].__key==e&&t.splice(s,1)}_limitQueueCount(t){t.length>a.MAX_QUEUE_LEN&&t.splice(0,t.length-a.MAX_QUEUE_LEN)}pushToQueue(t){u[t.cmd]?this.cmdQueueASync.push(t):this.cmdQueue.push(t),this._filterSameCmd(this.cmdQueueASync),this._filterSameCmd(this.cmdQueue),this._limitQueueCount(this.cmdQueueASync),this._limitQueueCount(this.cmdQueue)}getQueueInfo(){return`当前队列数:${this.cmdQueue.length}`}_getNextCmdData(t){if(0==this.cmdQueue.length&&0==this.cmdQueueASync.length)return null;if(!t)return 0==this.cmdQueue.length?null:this.cmdQueue.shift();let e=null;return this.cmdQueue.length>0&&this.cmdQueueASync.length>0&&(e=this.lastSendSync?this.cmdQueueASync.shift():this.cmdQueue.shift()),e||(this.cmdQueue.length>0?e=this.cmdQueue.shift():this.cmdQueueASync.length>0&&(e=this.cmdQueueASync.shift())),this.lastSendSync=!this.lastSendSync,e}_sendNext(t){if(this.inRequest)return;let e=this._getNextCmdData(t);e&&(this.inRequest=!0,this._log("[[send http]]",e),this.xhr.send(this.urlServer,JSON.stringify(e),"post","json"),this.fire(d.DATA_QUEUE_CHG,this.cmdQueue,this.cmdQueueASync))}_onHttpResponse(t,e){this.inRequest=!1,"complete"==t&&(this._log("[[onHttpResponse]]",e),-1==e.error?console.error(e.result.msg):this.dealDataCall?this.dealDataCall(e.result):this._log("nobody deal data",e))}}class v{constructor(t,e,s){this.mgr=t,this.logic=e,this.client=s,this.waitCmdQueue=[]}refreshView(){this.logic.sendJobCmd(h.FILE_READ_CONFIG,{filename:"project_config.json"},this._onAllProjects,this)}_onElementCreated(){this.client.on(d.DATA_QUEUE_CHG,this,this._onCmdQueueChg),this.client.on(d.SERVER_BUSY,this,this._onServerBusy),this.logic.on(_.PROJ_STATUS_UPDATE,this,this._onProjStatusUpdate),this.logic.updateVoData(),this.setStatusText("误操作，可通过刷新网页重置")}_onAllProjects(t){let e=JSON.parse(t.content);if(!e)return void console.error("parse json failed");let s=e.projects,i=[["更新",this._onBtnUpdateProject.bind(this)],["同步资源",this._onBtnSyncResource.bind(this)]];this.mgr.isAdmin()&&i.push(["状态重置",this._onBtnResetStatus.bind(this)]),this._createProjectsItems(s,i),this._onElementCreated()}_onCmdQueueChg(t){}_onServerBusy(t){console.log("服务器繁忙，自动重试中",t),this.addWaitCmd(t.cmd,t.data,t.data.projName),this.logic.updateVoProjStatus()}_onProjStatusUpdate(t){let e=t.getProjStatusAll();for(let t in e){let s=e[t];this.isProjInLock(t)||this._updateProjStatusText(t,s)}if(this._filterQueueByStatus(e),this.waitCmdQueue.length>0&&t.isAllDone()){let t=this.waitCmdQueue.shift();this.logic.sendJobCmd(t.cmd,t.data),this._updateWaitCmdText()}}_onBtnUpdateProject(t){this.setStatusText("");let e=a.VO.DATA_PROJ_STATUS,s=this.logic.getData(e);if(s.isStatusDone(t)&&!this.isProjInLock(t)){if(!s.isAllDone())return this.addWaitCmd(h.CMD_UPDATE_CLIENT,{projName:t},t),void this.setStatusText("等待中...",t);s.setStatus(t,m.PREPARE),this.logic.sendJobCmd(h.CMD_UPDATE_CLIENT,{projName:t}),this.setStatusText("准备开始...",t)}else alert("正在执行中，请稍后再试")}_onBtnSyncResource(t){this.setStatusText("");let e=a.VO.DATA_PROJ_STATUS,s=this.logic.getData(e);if(s.isStatusDone(t)&&!this.isProjInLock(t)){if(!s.isAllDone())return this.addWaitCmd(h.CMD_SYNC_ART_RES,{projName:t},t),void this.setStatusText("等待中...",t);s.setStatus(t,m.PREPARE),this.logic.sendJobCmd(h.CMD_SYNC_ART_RES,{projName:t}),this.setStatusText("准备开始...",t)}else alert("正在执行中，请稍后再试")}_onBtnResetStatus(t){this.logic.sendJobCmd(h.STATUS_RESET_STATUS,{projName:t})}_updateProjStatusText(t,e){let s,i="";if(e.cmd==n.UPDATE_CLIENT?i="更新":e.cmd==n.SYNC_ART_RES&&(i="同步"),e.status==m.NONE||e.status==m.ERROR){s=i+"结束时间: "+new Date(Number(e.lastUpdateTime||e.startTime)).toLocaleString()}else{s=i+"开始时间: "+new Date(Number(e.startTime)).toLocaleString()}let r="";switch(e.status){case m.NONE:break;case m.PREPARE:r="准备开始...";break;case m.EXPORT_PROTOL:r="更新协议中...";break;case m.EXPORT_EXCEL:r="导出excel中...";break;case m.EXPORT_UI:r="导出UI中...";break;case m.COMPILE_CLIENT:r="编译客户端中...";break;case m.COMPRESS_IMAGE:r="图片处理中...";break;case m.SYNC_ART_RES:r="同步资源中...";break;case m.COMPRESS_SPINE:r="spine处理中...";break;case m.ERROR:{let t=e.errMsg.indexOf(":"),s=e.errMsg;t>0&&(s=e.errMsg.substr(0,t)),r="处理失败:"+s+" 详细log查看控制台",console.error(e.errMsg)}}this.setStatusText(s+"\n"+r,t)}setStatusText(t,e){this.msgLabels&&(e?this.msgLabels[e].innerHTML=t:this.msgLabels.lblCommon.innerHTML=t)}_createElement(t,e){let s=document.createElement(t);return e&&e.appendChild(s),s}_br(t,e=1){for(let s=0;s<e;s++)t.appendChild(document.createElement("br"))}_createProjectsItems(t,e){let s={},i={},l=document.getElementById("divProjRoot"),a=this._createElement("label",l);i.lblCommon=a,this._br(l);let o=r.getBaseUrl();for(let r of t){let t=r.name;s[t]=r;let a=this._createElement("div",l),n=this._createElement("a",a);n.href=o+r.httpPath,n.target="_blank",n.style="font-size: 30px;",n.innerText=t,this._br(a,1);for(let s of e){let e=this._createElement("button",a);e.style="height: 30px; width: 140px; font-size: 20px;",e.innerText=s[0],e.onclick=(()=>{s[1](t)})}this._br(a,1);let h=this._createElement("label",a);i[t]=h,this._br(a,2)}this.projsCfg=s,this.msgLabels=i}addWaitCmd(t,e,s){this.waitCmdQueue.push({cmd:t,data:e,lockProject:s}),this._updateWaitCmdText()}_filterQueueByStatus(t){for(let e in t){let s=t[e];if(s.status!=m.NONE){let t;s.cmd==n.UPDATE_CLIENT?t=h.CMD_UPDATE_CLIENT:s.cmd==n.SYNC_ART_RES&&(t=h.CMD_SYNC_ART_RES),this._removeWaitCmd(t,e)}}}_removeWaitCmd(t,e){let s=!1;for(let i=0;i<this.waitCmdQueue.length;i++){let r=this.waitCmdQueue[i];if(r.cmd==t&&r.lockProject==e){this.waitCmdQueue.splice(i,1),s=!0;break}}s&&this._updateWaitCmdText()}_updateWaitCmdText(){if(0==this.waitCmdQueue.length)return void this.setStatusText("");let t=[];t.push("等待执行:"+this.waitCmdQueue.length);for(let e of this.waitCmdQueue)e.cmd==h.CMD_UPDATE_CLIENT?t.push("更新项目："+e.lockProject):e.cmd==h.CMD_SYNC_ART_RES&&t.push("同步资源："+e.lockProject);this.setStatusText(t.join("<br/>"))}isProjInLock(t){for(let e of this.waitCmdQueue)if(e.lockProject==t)return!0;return!1}}new class{constructor(){!function(t){let e=new C,s=new i(t,e);s.addCheck("mgr"),e.initAll(s.cbkListener.bind(s,"mgr"))}(t=>{let e=new O(t);e.registerAll();let s=t.plugin,i=new j(t);t.client=i,i.setDealDataCall(s.dealResponseData.bind(s)),s.setServerSendCall(i.send.bind(i)),s.setServerBusyCall(i.onServerBusy.bind(i)),new v(t,e,i).refreshView()})}}}();